!function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=32)}([function(t,e,i){"use strict";var r=i(2),n=t.exports;n.Direction={NORTH:0,EAST:1,SOUTH:2,WEST:3},n.SquareType={WALL:0,OPEN:1,START:2,FINISH:3,OBSTACLE:4,STARTANDFINISH:5},n.TurnDirection={LEFT:-1,RIGHT:1},n.MoveDirection={FORWARD:0,RIGHT:1,BACKWARD:2,LEFT:3},n.directionToDxDy=function(t){switch(t){case n.Direction.NORTH:return{dx:0,dy:-1};case n.Direction.EAST:return{dx:1,dy:0};case n.Direction.SOUTH:return{dx:0,dy:1};case n.Direction.WEST:return{dx:-1,dy:0}}throw new Error("Invalid direction value"+t)},n.directionToFrame=function(t){return r.mod(4*t,16)},n.constrainDirection4=function(t){return r.mod(t,4)}},function(t,e,i){"use strict";var r=i(4),n=i(28),o=i(0).SquareType,s=i(27).EventEmitter,a={10010:[4,0],10001:[3,3],11000:[0,1],10100:[0,2],11010:[4,1],10101:[3,2],10110:[0,0],10011:[2,0],11001:[4,2],11100:[2,3],11110:[1,1],10111:[1,0],11011:[2,1],11101:[1,2],11111:[2,2],null0:[4,3],null1:[3,0],null2:[3,1],null3:[0,3],null4:[1,3]};t.exports=function(t){function e(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.skin,o=r.level;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return s.maze_=i,s.skin_=n,s.startDirection=o?o.startDirection:0,s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.getValue=function(t,e){return this.getCell(t,e).getCurrentValue()},e.prototype.setValue=function(t,e,i){this.getCell(t,e).setCurrentValue(i)},e.prototype.getCell=function(t,e){return this.maze_.map.currentStaticGrid[t][e]},e.prototype.getCellClass=function(){return r},e.prototype.loadAudio=function(t){},e.prototype.playAudio_=function(t){this.maze_.playAudio&&this.maze_.playAudio(t)},e.prototype.createDrawer=function(t){this.drawer=new n(this.maze_.map,this.skin_.dirt,t)},e.prototype.reset=function(){this.emit("reset")},e.prototype.isFarmer=function(){return!1},e.prototype.isCollector=function(){return!1},e.prototype.isScrat=function(){return!1},e.prototype.isWordSearch=function(){return!1},e.prototype.isBee=function(){return!1},e.prototype.isOnPathStr_=function(t,e){return this.isWallOrOutOfBounds_(t,e)?"0":"1"},e.prototype.isWallOrOutOfBounds_=function(t,e){return this.maze_.map.getTile(e,t)===o.WALL||void 0===this.maze_.map.getTile(e,t)},e.prototype.getEmptyTile=function(t,e,i,r){var n=void 0;if(r||!i&&Math.random()>.2)this.wallMap[e][t]=0,n="null0";else{var o=Math.floor(1+4*Math.random());this.wallMap[e][t]=o,n="null"+o}return n},e.prototype.drawMapTiles=function(t){var e=this,i=0,r=void 0;this.maze_.map.forEachCell(function(n,o,s){if(r=e.isOnPathStr_(s,o)+e.isOnPathStr_(s,o-1)+e.isOnPathStr_(s+1,o)+e.isOnPathStr_(s,o+1)+e.isOnPathStr_(s-1,o),!a[r]){var u="00000"!==r,l=u&&r.split("1").length>2;r=e.getEmptyTile(s,o,u,l)}e.drawTile(t,a[r],o,s,i),e.drawer.updateItemImage(o,s,!1),i++})},e.prototype.scheduleDirtChange=function(t,e){this.drawer.updateItemImage(t,e,!0)},e.prototype.drawTile=function(t,e,i,r,n){this.drawer.drawTile(t,e,i,r,n,this.skin_.tiles)},e.prototype.initWallMap=function(){this.wallMap=new Array(this.maze_.map.ROWS);for(var t=0;t<this.maze_.map.ROWS;t++)this.wallMap[t]=new Array(this.maze_.map.COLS)},e.prototype.initStartFinish=function(){this.start=void 0,this.finish=void 0;for(var t=0;t<this.maze_.map.ROWS;t++)for(var e=0;e<this.maze_.map.COLS;e++){var i=this.maze_.map.getTile(t,e);i===o.START?this.start={x:e,y:t}:i===o.FINISH?this.finish={x:e,y:t}:i===o.STARTANDFINISH&&(this.start={x:e,y:t},this.finish={x:e,y:t})}},e}(s)},function(t,e,i){"use strict";t.exports.mod=function(t,e){return(t%e+e)%e},t.exports.randomValue=function(t){return t[Math.floor(Math.random()*t.length)]},t.exports.rotate2DArray=function(t){return t[0].map(function(e,i){return t.map(function(e){return e[t.length-i-1]})})},t.exports.range=function(t,e){for(var i=[],r=t;r<=e;r++)i.push(r);return i},t.exports.createUuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},t.exports.isFarmerSkin=function(t){return/farmer(_night)?/.test(t)},t.exports.isBeeSkin=function(t){return/bee(_night)?/.test(t)},t.exports.isCollectorSkin=function(t){return/collector(_night)?/.test(t)},t.exports.isScratSkin=function(t){return/scrat/.test(t)},t.exports.isPlanterSkin=function(t){return/planter/.test(t)},t.exports.isHarvesterSkin=function(t){return/harvester/.test(t)},t.exports.isWordSearchSkin=function(t){return"letters"===t},t.exports.getSubtypeForSkin=function(e){return t.exports.isFarmerSkin(e)?i(29):t.exports.isBeeSkin(e)?i(26):t.exports.isCollectorSkin(e)?i(23):t.exports.isWordSearchSkin(e)?i(21):t.exports.isScratSkin(e)?i(19):t.exports.isHarvesterSkin(e)?i(18):t.exports.isPlanterSkin(e)?i(15):i(1)}},function(t,e,i){"use strict";var r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],r=!0,n=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);r=!0);}catch(t){n=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var n="http://www.w3.org/2000/svg";t.exports=function(){function t(e,i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.map_=e,this.asset_=i,this.svg_=r}return t.cellId=function(t,e,i){return t+"_"+e+"_"+i},t.prototype.getAsset=function(t,e,i){return this.asset_},t.prototype.reset=function(){},t.prototype.updateItemImage=function(t,e,i){return this.drawImage_("",t,e)},t.prototype.drawImage_=function(e,i,r){var n=this.svg_.querySelector("#"+t.cellId(e,i,r)),o=this.getAsset(e,i,r);if(n||o)return(n=this.getOrCreateImage_(e,i,r))&&(n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o||""),n.setAttribute("visibility",o?"visible":"hidden")),n},t.prototype.getOrCreateImage_=function(e,i,r){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=this.getAsset(e,i,r),a=t.cellId(e,i,r),u=this.svg_.querySelector("#"+a);if(u)return u;if(s){var l=this.svg_.getElementsByClassName("pegman-location")[0],p=void 0;if(o){p=t.cellId(e+"Clip",i,r);var c=document.createElementNS(n,"clipPath");c.setAttribute("id",p);var h=document.createElementNS(n,"rect");h.setAttribute("x",50*r),h.setAttribute("y",50*i),h.setAttribute("width",50),h.setAttribute("height",50),c.appendChild(h),this.svg_.insertBefore(c,l)}return(u=document.createElementNS(n,"image")).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s),u.setAttribute("height",50),u.setAttribute("width",50),u.setAttribute("x",50*r),u.setAttribute("y",50*i),u.setAttribute("id",a),o&&u.setAttribute("clip-path","url(#"+p+")"),this.svg_.insertBefore(u,l),u}},t.prototype.updateOrCreateText_=function(e,i,r,o){var s=this.svg_.getElementsByClassName("pegman-location")[0],a=this.svg_.querySelector("#"+t.cellId(e,i,r));if(!a){(a=document.createElementNS(n,"text")).setAttribute("class","karel-counter-text"),a.setAttribute("x",50*(r+1)-2),a.setAttribute("y",50*(i+1)-2),a.setAttribute("id",t.cellId(e,i,r)),a.appendChild(document.createTextNode("")),this.svg_.insertBefore(a,s)}return a.firstChild.nodeValue=o,a},t.prototype.drawTile=function(t,e,i,o,s,a){var u=r(e,2),l=u[0],p=u[1],c=document.createElementNS(n,"clipPath");c.setAttribute("id","tileClipPath"+s);var h=document.createElementNS(n,"rect");h.setAttribute("width",50),h.setAttribute("height",50),h.setAttribute("x",50*o),h.setAttribute("y",50*i),c.appendChild(h),t.appendChild(c);var f=document.createElementNS(n,"image");f.setAttribute("id","tileElement"+s),f.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a),f.setAttribute("height",200),f.setAttribute("width",250),f.setAttribute("clip-path","url(#tileClipPath"+s+")"),f.setAttribute("x",50*(o-l)),f.setAttribute("y",50*(i-p)),t.appendChild(f);var m=document.createElementNS(n,"animate");m.setAttribute("id","tileAnimation"+s),m.setAttribute("attributeType","CSS"),m.setAttribute("attributeName","opacity"),m.setAttribute("from",1),m.setAttribute("to",0),m.setAttribute("dur","1s"),m.setAttribute("begin","indefinite"),f.appendChild(m)},t}(),t.exports.SQUARE_SIZE=50,t.exports.SVG_NS=n},function(t,e,i){"use strict";t.exports=function(){function t(e,i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tileType_=e,this.originalValue_=i,this.currentValue_=void 0,this.resetCurrentValue(),this.range_=isNaN(r)?i:r}return t.prototype.clone=function(){var t=this.constructor.deserialize(this.serialize());return t.setCurrentValue(this.currentValue_),t},t.prototype.getTile=function(){return this.tileType_},t.prototype.hasValue=function(){return void 0!==this.currentValue_},t.prototype.isDirt=function(){return void 0!==this.currentValue_},t.prototype.isVariableRange=function(){return this.range_!==this.originalValue_},t.prototype.isVariable=function(){return this.isVariableRange()},t.prototype.getOriginalValue=function(){return this.originalValue_},t.prototype.getCurrentValue=function(){return this.currentValue_},t.prototype.setCurrentValue=function(t){this.currentValue_=t},t.prototype.resetCurrentValue=function(){this.currentValue_=this.originalValue_},t.prototype.getPossibleGridAssets=function(){var e=[];if(this.isVariableRange())for(var i=Math.min(this.originalValue_,this.range_),r=Math.max(this.originalValue_,this.range_),n=i;n<=r;n++)e.push(new t(this.tileType_,n));else e.push(this);return e},t.prototype.serialize=function(){return{tileType:this.tileType_,value:this.originalValue_,range:this.range_}},t.deserialize=function(e){return new t(e.tileType,e.value,e.range)},t.parseFromOldValues=function(e,i){e=parseInt(e),i=parseInt(i);var r,n=void 0;return r=parseInt(e),isNaN(i)||0===i||(n=i),new t(r,n)},t}()},function(t,e,i){"use strict";t.exports.SVG_NS="http://www.w3.org/2000/svg"},function(t,e,i){"use strict";var r=i(1);t.exports=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.reset=function(){this.maze_.map.resetDirt()},e.prototype.collectedEverything=function(){return!this.maze_.map.currentStaticGrid.some(function(t){return t.some(function(t){return t.isDirt()&&t.getCurrentValue()>0})})},e.prototype.succeeded=function(){return this.collectedEverything()},e}(r)},function(t,e,i){"use strict";var r=i(5).SVG_NS,n=i(0),o=i(2).createUuid,s=n.SquareType;function a(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;return Math.floor(i*(e+.5)-t.pegmanHeight/2+t.pegmanYOffset)}function u(t,e,i,r,n,o){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:50,u=t.pegmanXOffset||0;e.setAttribute("x",r*s-o*t.pegmanWidth+1+u),e.setAttribute("y",a(t,n)),i.setAttribute("x",r*s+1+u),i.setAttribute("y",e.getAttribute("y"))}t.exports=function(t,e,i,a){var l,p,c,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:50,f=a.COLS*h,m=a.ROWS*h,d=document.createElementNS(r,"rect");d.setAttribute("width",f),d.setAttribute("height",m),d.setAttribute("fill","#F1EEE7"),d.setAttribute("stroke-width",1),d.setAttribute("stroke","#CCB"),t.appendChild(d),e.background&&((c=document.createElementNS(r,"image")).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e.background),c.setAttribute("height",m),c.setAttribute("width",f),c.setAttribute("x",0),c.setAttribute("y",0),t.appendChild(c)),i.drawMapTiles(t);var y=document.createElementNS(r,"path");if(y.setAttribute("id","hintPath"),y.setAttribute("stroke","#c00"),y.setAttribute("stroke-width","5"),y.setAttribute("fill","none"),y.setAttribute("stroke-linecap","round"),y.setAttribute("stroke-linejoin","round"),t.appendChild(y),i.start){var g=document.createElementNS(r,"clipPath"),b="pegmanClipPath-"+o();g.setAttribute("id",b);var _=document.createElementNS(r,"rect");_.setAttribute("id","clipRect"),_.setAttribute("width",e.pegmanWidth),_.setAttribute("height",e.pegmanHeight),g.appendChild(_),t.appendChild(g);var v=document.createElementNS(r,"image");v.setAttribute("id","pegman"),v.setAttribute("class","pegman-location"),v.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e.avatar),v.setAttribute("height",e.pegmanHeight),v.setAttribute("width",21*e.pegmanWidth),v.setAttribute("clip-path","url(#"+b+")"),t.appendChild(v),u(e,v,_,i.start.x,i.start.y,n.directionToFrame(i.startDirection));var w=document.createElementNS(r,"animate");w.setAttribute("id","pegmanFadeoutAnimation"),w.setAttribute("attributeType","CSS"),w.setAttribute("attributeName","opacity"),w.setAttribute("from",1),w.setAttribute("to",0),w.setAttribute("dur","1s"),w.setAttribute("begin","indefinite"),v.appendChild(w)}if(i.finish&&e.goalIdle){var T=document.createElementNS(r,"image");T.setAttribute("id","finish"),T.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e.goalIdle),T.setAttribute("height",43),T.setAttribute("width",50),t.appendChild(T),T.setAttribute("x",h*(i.finish.x+.5)-T.getAttribute("width")/2),T.setAttribute("y",h*(i.finish.y+.9)-T.getAttribute("height")),T.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e.goalIdle),T.setAttribute("visibility","visible")}if(e.obstacleIdle){var A=0;for(p=0;p<a.ROWS;p++)for(l=0;l<a.COLS;l++){if(a.getTile(p,l)===s.OBSTACLE){var S=document.createElementNS(r,"image");S.setAttribute("id","obstacle"+A),S.setAttribute("height",43*e.obstacleScale),S.setAttribute("width",50*e.obstacleScale),S.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e.obstacleIdle),S.setAttribute("x",h*(l+.5)-S.getAttribute("width")/2),S.setAttribute("y",h*(p+.9)-S.getAttribute("height")),t.appendChild(S)}++A}}},t.exports.getPegmanYForRow=a,t.exports.displayPegman=u},function(t,e,i){"use strict";var r=[];t.exports.setTimeout=function(t,e){var i=window.setTimeout.apply(window,arguments);return r.push(i),i},t.exports.clearTimeouts=function(){r.forEach(window.clearTimeout,window),r.length=0},t.exports.clearTimeout=function(t){window.clearTimeout(t);var e=r.indexOf(t);e>-1&&r.splice(e,1)};var n=[];t.exports.setInterval=function(t,e){var i=window.setInterval.apply(window,arguments);return n.push(i),i},t.exports.clearIntervals=function(){n.forEach(window.clearInterval,window),n.length=0},t.exports.clearInterval=function(t){window.clearInterval(t);var e=o.indexOf(t);e>-1&&o.splice(e,1);var i=n.indexOf(t);i>-1&&n.splice(i,1)};var o=[];t.exports.timedLoop=function(t,e){var i=setInterval(e,t);return o.push(i),i},t.exports.stopTimedLoop=function(t){void 0===t?o.slice().forEach(function(t){return e.clearInterval(t)}):clearInterval(t)}},function(t,e,i){t.exports=i.p+"8910b6f2ba756d2a443b1bc4bbbeaf49.png"},function(t,e,i){t.exports=i.p+"8211dd5ec7e07659d2fce7ce4843e26f.png"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o(i(10)),n=o(i(9));function o(t){return t&&t.__esModule?t:{default:t}}e.default={skinId:"farmer",skin:{pegmanHeight:52,pegmanWidth:49,pegmanYOffset:-8,tiles:r.default,avatar:n.default},level:{startDirection:0,serializedMaze:[[{tileType:0},{tileType:0},{tileType:0},{tileType:0},{tileType:0},{tileType:0},{tileType:0},{tileType:0}],[{tileType:0},{tileType:0},{tileType:0},{tileType:0},{tileType:0},{tileType:0},{tileType:0},{tileType:0}],[{tileType:0},{tileType:1},{tileType:1,value:1,range:1},{tileType:1},{tileType:1,value:2,range:2},{tileType:1},{tileType:0},{tileType:0}],[{tileType:0},{tileType:1,value:4,range:4},{tileType:0},{tileType:1},{tileType:0},{tileType:1,value:3,range:3},{tileType:0},{tileType:0}],[{tileType:0},{tileType:1},{tileType:1},{tileType:2},{tileType:1},{tileType:1},{tileType:0},{tileType:0}],[{tileType:0},{tileType:1,value:3,range:3},{tileType:0},{tileType:1},{tileType:0},{tileType:1,value:1,range:1},{tileType:0},{tileType:0}],[{tileType:0},{tileType:1},{tileType:1,value:2,range:2},{tileType:1},{tileType:1,value:4,range:4},{tileType:1},{tileType:0},{tileType:0}],[{tileType:0},{tileType:0},{tileType:0},{tileType:0},{tileType:0},{tileType:0},{tileType:0},{tileType:0}]]}},t.exports=e.default},function(t,e,i){"use strict";t.exports=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.grid_=e,this.ROWS=this.grid_.length,this.COLS=this.grid_[0].length,this.staticGrids=this.constructor.getAllStaticGrids(this.grid_),this.currentStaticGrid=this.staticGrids[0]}return t.cloneGrid=function(t){return t.map(function(t){return t.map(function(t){return t.clone()})})},t.getAllStaticGrids=function(t){var e=this,i=[t];return t.forEach(function(t,r){t.forEach(function(t,n){if(t.isVariable()){var o=[];t.getPossibleGridAssets().forEach(function(t){i.forEach(function(i){var s=e.cloneGrid(i);s[r][n]=t,o.push(s)})}),i=o}})}),i},t.deserialize=function(e,i){return new t(e.map(function(t){return t.map(i.deserialize)}))},t.parseFromOldValues=function(e,i,r){return new t(e.map(function(t,e){return t.map(function(t,n){var o=i&&i[e][n];return r.parseFromOldValues(t,o)})}))},t.prototype.resetDirt=function(){this.forEachCell(function(t){t.resetCurrentValue()})},t.prototype.forEachCell=function(t){this.currentStaticGrid.forEach(function(e,i){e.forEach(function(e,r){t(e,i,r)})})},t.prototype.getAllCells=function(){return this.currentStaticGrid.reduce(function(t,e){return t.concat(e)},[])},t.prototype.getCell=function(t,e){return this.currentStaticGrid[t]&&this.currentStaticGrid[t][e]},t.prototype.isDirt=function(t,e){var i=this.getCell(t,e);return i&&i.isDirt()},t.prototype.getTile=function(t,e){var i=this.getCell(t,e);return i&&i.getTile()},t.prototype.getValue=function(t,e){var i=this.getCell(t,e);return i&&i.getCurrentValue()},t.prototype.setValue=function(t,e,i){this.currentStaticGrid[t]&&this.currentStaticGrid[t][e]&&this.currentStaticGrid[t][e].setCurrentValue(i)},t.prototype.getVariableCell=function(t,e){if(this.grid_[t]&&this.grid_[t][e])return this.grid_[t][e]},t.prototype.useGridWithId=function(t){this.currentStaticGrid=this.staticGrids[t],this.resetDirt()},t.prototype.clone=function(){this.constructor.cloneGrid(this.grid_)},t.prototype.hasMultiplePossibleGrids=function(){return this.staticGrids.length>1},t}()},function(t,e,i){"use strict";var r=i(3);t.exports=function(t){function e(i,r,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,"",n));return s.skin_=r,s.subtype_=o,s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.getAsset=function(t,e,i){var r=this.subtype_.getCell(e,i).featureName();return this.skin_[r]},e}(r)},function(t,e,i){"use strict";var r=i(4),n={NONE:0,SOIL:1,SPROUT:2};t.exports=function(t){function e(i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===r&&(r=n.NONE);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i));return o.originalFeatureType_=r,o.currentFeatureType_=void 0,o.resetCurrentFeature(),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.setFeatureType=function(t){this.currentFeatureType_=t},e.prototype.featureType=function(){return this.currentFeatureType_},e.prototype.originalFeatureType=function(){return this.originalFeatureType_},e.prototype.resetCurrentFeature=function(){this.currentFeatureType_=this.originalFeatureType_},e.prototype.featureName=function(){return["none","soil","sprout"][this.currentFeatureType_]},e.prototype.isSoil=function(){return this.currentFeatureType_===n.SOIL},e.prototype.isSprout=function(){return this.currentFeatureType_===n.SPROUT},e.prototype.serialize=function(){return Object.assign({},t.prototype.serialize.call(this),{featureType:this.originalFeatureType_})},e.deserialize=function(t){return new e(t.tileType,t.featureType)},e}(r),t.exports.FeatureType=n},function(t,e,i){"use strict";var r=i(1),n=i(14),o=i(13);t.exports=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.reset=function(){this.maze_.map.forEachCell(function(t){t.resetCurrentFeature()})},e.prototype.getCellClass=function(){return n},e.prototype.createDrawer=function(t){this.drawer=new o(this.maze_.map,this.skin_,t,this)},e.prototype.atSprout=function(){return this.atType(n.FeatureType.SPROUT)},e.prototype.atSoil=function(){return this.atType(n.FeatureType.SOIL)},e.prototype.atType=function(t){var e=this.maze_.pegmanX,i=this.maze_.pegmanY;return this.getCell(i,e).featureType()===t},e.prototype.tryPlant=function(){var t=this.maze_.pegmanX,e=this.maze_.pegmanY,i=this.getCell(e,t);return i.featureType()!==n.FeatureType.SOIL?(this.emit("plantInNonSoil"),!1):(i.setFeatureType(n.FeatureType.SPROUT),!0)},e.prototype.animatePlant=function(){var t=this.maze_.pegmanX,e=this.maze_.pegmanY,i=this.getCell(e,t);if(i.featureType()!==n.FeatureType.SOIL)throw new Error("Shouldn't be able to plant in anything but soil");i.setFeatureType(n.FeatureType.SPROUT),this.drawer.updateItemImage(e,t,!0)},e}(r)},function(t,e,i){"use strict";var r=i(3);t.exports=function(t){function e(i,r,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,"",n));return s.skin_=r,s.subtype_=o,s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.getAsset=function(t,e,i){switch(t){case"sprout":return this.skin_.sprout;case"crop":var r=this.subtype_.getCell(e,i).featureName();return this.skin_[r]}},e.prototype.updateItemImage=function(t,e,i){var r=this.map_.getVariableCell(t,e),n=this.map_.getCell(t,e);r.hasValue()&&(n.startsHidden()&&!i?(this.show("sprout",t,e),this.hide("crop",t,e)):(n.getCurrentValue()>0?this.show("crop",t,e):this.hide("crop",t,e),this.hide("sprout",t,e)),i?n.getCurrentValue()>0?this.updateOrCreateText_("counter",t,e,n.getCurrentValue()):this.updateOrCreateText_("counter",t,e,""):n.startsHidden()?this.updateOrCreateText_("counter",t,e,""):r.isVariableRange()?this.updateOrCreateText_("counter",t,e,"?"):this.updateOrCreateText_("counter",t,e,n.getCurrentValue()))},e.prototype.hide=function(t,e,i){var r=this.getOrCreateImage_(t,e,i);r&&r.setAttribute("visibility","hidden")},e.prototype.show=function(t,e,i){this.drawImage_(t,e,i)},e}(r)},function(t,e,i){"use strict";var r=i(4),n=i(0).SquareType,o={NONE:0,CORN:1,PUMPKIN:2,LETTUCE:3};t.exports=function(t){function e(i,r,s,a,u){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),void 0!==a&&i===n.OPEN||(a=[o.NONE]),Array.isArray(a)||(a=[a]),a.every(function(t){return t===o.NONE})&&(r=void 0,s=void 0);var l=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,r,s));return a.length>1&&(u=!0),l.possibleFeatures_=a,l.startsHidden_=!!u,l}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.startsHidden=function(){return this.startsHidden_},e.prototype.isVariableFeature=function(){return this.possibleFeatures_.length>1},e.prototype.isVariable=function(){return this.isVariableFeature()||t.prototype.isVariable.call(this)},e.prototype.getPossibleGridAssets=function(){var t=this,i=[];if(this.isVariableFeature())i=this.possibleFeatures_.map(function(i){return e.deserialize(Object.assign({},t.serialize(),{possibleFeatures:[i]}))});else if(this.isVariableRange())for(var r=this.originalValue_;r<=this.range_;r++)i.push(e.deserialize(Object.assign({},this.serialize(),{value:r,range:r})));else i.push(this);return i},e.prototype.featureType=function(){if(!this.isVariableFeature())return this.possibleFeatures_[0]},e.prototype.featureName=function(){return this.isVariableFeature()?"unknown":["none","corn","pumpkin","lettuce"][this.possibleFeatures_[0]]},e.prototype.isCorn=function(){return this.possibleFeatures_.includes(o.CORN)},e.prototype.isPumpkin=function(){return this.possibleFeatures_.includes(o.PUMPKIN)},e.prototype.isLettuce=function(){return this.possibleFeatures_.includes(o.LETTUCE)},e.prototype.serialize=function(){return Object.assign({},t.prototype.serialize.call(this),{possibleFeatures:this.possibleFeatures_,startsHidden:this.startsHidden_})},e.deserialize=function(t){return new e(t.tileType,t.value,t.range,t.possibleFeatures,t.startsHidden)},e}(r),t.exports.FeatureType=o},function(t,e,i){"use strict";var r=i(6),n=i(17),o=i(16);t.exports=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.getCellClass=function(){return n},e.prototype.loadAudio=function(t){t.harvestSound&&this.maze_.loadAudio(t.harvestSound,"harvest")},e.prototype.createDrawer=function(t){this.drawer=new o(this.maze_.map,this.skin_,t,this)},e.prototype.hasCorn=function(){return this.hasCrop(n.FeatureType.CORN)},e.prototype.hasPumpkin=function(){return this.hasCrop(n.FeatureType.PUMPKIN)},e.prototype.hasLettuce=function(){return this.hasCrop(n.FeatureType.LETTUCE)},e.prototype.hasCrop=function(t){var e=this.maze_.pegmanX,i=this.maze_.pegmanY,r=this.getCell(i,e);return r.featureType()===t&&r.getCurrentValue()>0},e.prototype.atCorn=function(){return this.atCrop(n.FeatureType.CORN)},e.prototype.atPumpkin=function(){return this.atCrop(n.FeatureType.PUMPKIN)},e.prototype.atLettuce=function(){return this.atCrop(n.FeatureType.LETTUCE)},e.prototype.atCrop=function(t){var e=this.maze_.pegmanX,i=this.maze_.pegmanY;return this.getCell(i,e).featureType()===t},e.prototype.gotCropAt=function(t,e){var i=this.getCell(t,e);i.setCurrentValue(i.getCurrentValue()-1)},e.prototype.tryGetCorn=function(){return this.tryGetCrop(n.FeatureType.CORN)},e.prototype.tryGetPumpkin=function(){return this.tryGetCrop(n.FeatureType.PUMPKIN)},e.prototype.tryGetLettuce=function(){return this.tryGetCrop(n.FeatureType.LETTUCE)},e.prototype.tryGetCrop=function(t){var e=this.maze_.pegmanX,i=this.maze_.pegmanY,r=this.getCell(i,e);return r.featureType()!==t?(this.emit("wrongCrop"),!1):0===r.getCurrentValue()?(this.emit("emptyCrop"),!1):(this.gotCropAt(i,e),!0)},e.prototype.animateGetCorn=function(){this.animateGetCrop(n.FeatureType.CORN)},e.prototype.animateGetPumpkin=function(){this.animateGetCrop(n.FeatureType.PUMPKIN)},e.prototype.animateGetLettuce=function(){this.animateGetCrop(n.FeatureType.LETTUCE)},e.prototype.animateGetCrop=function(t){var e=this.maze_.pegmanX,i=this.maze_.pegmanY,r=this.getCell(i,e);if(r.featureType()!==t)throw new Error("Shouldn't be able to harvest the wrong kind of crop");if(r.getCurrentValue()<=0)throw new Error("Shouldn't be able to end up with a harvest animation if there was nothing left to harvest");this.playAudio_("harvest"),this.gotCropAt(i,e),this.drawer.updateItemImage(i,e,!0)},e}(r)},function(t,e,i){"use strict";var r=i(0).SquareType,n=i(2).randomValue,o=i(1),s={log:[0,0],lily1:[1,0],land1:[2,0],island_start:[0,1],island_topRight:[1,1],island_botLeft:[0,2],island_botRight:[1,2],water:[0,4],lily2:[2,1],lily3:[3,1],lily4:[2,2],lily5:[3,2],ice:[3,0],cracked_ice:[4,0],empty:[0,4]};t.exports=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.isScrat=function(){return!0},e.prototype.isWaterOrOutOfBounds=function(t,e){return this.isWater(t,e)||void 0===this.maze_.map.getTile(e,t)},e.prototype.isWater=function(t,e){return this.maze_.map.getTile(e,t)===r.WALL},e.prototype.isObstacle=function(t,e){return this.maze_.map.getTile(e,t)===r.OBSTACLE},e.prototype.drawMapTiles=function(t){var e=void 0,i=void 0,r=[];for(e=0;e<this.maze_.map.ROWS;e++)for(i=0;i<this.maze_.map.COLS;i++)this.isWater(i,e)&&this.isWater(i+1,e)&&this.isWater(i,e+1)&&this.isWater(i+1,e+1)&&r.push({row:e,col:i});var o=n(r),a={};o&&(a[o.row+0+"_"+(o.col+0)]="island_start",a[o.row+1+"_"+(o.col+0)]="island_botLeft",a[o.row+0+"_"+(o.col+1)]="island_topRight",a[o.row+1+"_"+(o.col+1)]="island_botRight");var u=0,l=void 0;for(e=0;e<this.maze_.map.ROWS;e++)for(i=0;i<this.maze_.map.COLS;i++){if(this.isObstacle(i,e))l="cracked_ice";else if(this.isWaterOrOutOfBounds(i,e)){var p=!(this.isWaterOrOutOfBounds(i,e-1)&&this.isWaterOrOutOfBounds(i+1,e)&&this.isWaterOrOutOfBounds(i,e+1)&&this.isWaterOrOutOfBounds(i-1,e));l="water",(l=a[e+"_"+i])||(l=n(["empty","empty","empty","empty","empty","lily2","lily3","lily4","lily5","lily1","log","lily1","land1"])),p&&"land1"===l&&(l="empty")}else l="ice";this.drawTile(t,s[l],e,i,u),u++}},e}(o)},function(t,e,i){"use strict";var r=i(3),n=r.SQUARE_SIZE,o=r.SVG_NS,s="#000",a="#fff";t.exports=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.drawTile=function(t,e,i,s){var a=r.cellId("backgroundLetter",i,s),u=document.createElementNS(o,"g"),l=document.createElementNS(o,"rect");l.setAttribute("id",a),l.setAttribute("width",n),l.setAttribute("height",n),l.setAttribute("x",s*n),l.setAttribute("y",i*n),l.setAttribute("stroke","#000000"),l.setAttribute("stroke-width",3),u.appendChild(l);var p=this.updateOrCreateText_("letter",i,s,e);u.appendChild(p),t.appendChild(u)},e.prototype.updateOrCreateText_=function(e,i,r,o){var s=t.prototype.updateOrCreateText_.call(this,e,i,r,o);return s.setAttribute("class","search-letter"),s.setAttribute("width",n),s.setAttribute("height",n),s.setAttribute("x",(r+.5)*n),s.setAttribute("y",(i+.5)*n),s.setAttribute("font-size",32),s.setAttribute("text-anchor","middle"),s.setAttribute("font-family","Verdana"),s},e.prototype.updateTileHighlight=function(t,e,i){var o=(t+e)%2==0?"#dae3f3":"#ffffff",u=i?a:s;i&&(o="#00b050");var l=r.cellId("backgroundLetter",t,e),p=r.cellId("letter",t,e);document.getElementById(l).setAttribute("fill",o);var c=document.getElementById(p);if(c.setAttribute("fill",u),c.getBBox){var h=c.getBBox(),f=n-h.height,m=t*n+f/2-h.y;c.setAttribute("transform","translate(0, "+m+")")}},e}(r)},function(t,e,i){"use strict";var r=i(1),n=i(20),o=i(0).SquareType,s=i(2).randomValue,a=function(t){function e(i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,r));return n.goal_=r.level.searchWord,n.visited_="",n.map_=r.level.map,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.getVisited=function(){return this.visited_},e.prototype.isWordSearch=function(){return!0},e.prototype.createDrawer=function(t){this.drawer=new n(this.maze_.map,"",t)},e.prototype.isOpen_=function(t,e){var i=this.map_;return void 0!==i[t]&&void 0!==i[t][e]&&i[t][e]!==o.WALL},e.prototype.openNeighbors_=function(t,e){var i=[];return this.isOpen_(t+1,e)&&i.push([t+1,e]),this.isOpen_(t-1,e)&&i.push([t-1,e]),this.isOpen_(t,e+1)&&i.push([t,e+1]),this.isOpen_(t,e-1)&&i.push([t,e-1]),i},e.prototype.restrictedValues_=function(t,i){for(var r=this.map_,n=this.openNeighbors_(t,i),o=[],s=0;s<n.length;s++)for(var a=this.openNeighbors_(n[s][0],n[s][1]),u=0;u<a.length;u++){var l=a[u][0],p=a[u][1],c=e.letterValue(r[l][p],!1);o.push(c,!1)}return o},e.prototype.drawMapTiles=function(t){for(var i=void 0,r=void 0,n=0;n<this.map_.length;n++)for(var o=0;o<this.map_[n].length;o++){var s=this.map_[n][o];s===e.EMPTY_CHAR?(r=this.restrictedValues_(n,o),i=e.randomLetter(r)):i=e.letterValue(s,!0),this.drawTile(t,i,n,o)}},e.prototype.resetTiles=function(){for(var t=0;t<this.map_.length;t++)for(var e=0;e<this.map_[t].length;e++)this.drawer.updateTileHighlight(t,e,!1);document.getElementById("currentWordContents").textContent="",this.visited_=""},e.prototype.markTileVisited=function(t,e,i){var r=document.getElementById(n.cellId("letter",t,e));this.visited_+=r.textContent,i&&(this.drawer.updateTileHighlight(t,e,!0),document.getElementById("currentWordContents").textContent=this.visited_)},e}(r);a.START_CHAR="-",a.EMPTY_CHAR="_",a.ALL_CHARS=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],a.letterValue=function(t){if("number"==typeof t)return a.START_CHAR;if("string"==typeof t)return 2===t.length&&"_"===t[0]?t[1]:t[0];throw new Error("unexpected value for letterValue")},a.randomLetter=function(t){var e=a.ALL_CHARS;return t&&(t=new Set(t),e=e.filter(function(e){return!t.has(e)})),s(e)},t.exports=a},function(t,e,i){"use strict";var r=i(3);t.exports=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.drawImage_=function(e,i,r){var n=t.prototype.drawImage_.call(this,e,i,r),o=this.map_.getValue(i,r);return n.setAttribute("visibility",o?"visible":"hidden"),n},e.prototype.updateItemImage=function(e,i,r){if(this.shouldUpdateItemImage(e,i,r)){t.prototype.updateItemImage.call(this,e,i);var n=this.map_.getValue(e,i)||null;this.updateOrCreateText_("counter",e,i,n)}},e.prototype.shouldUpdateItemImage=function(t,e){var i=this.map_.getCell(t,e);return i&&i.getOriginalValue()},e}(r)},function(t,e,i){"use strict";var r=i(1),n=i(22);t.exports=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.scheduleDirtChange=function(e,i){t.prototype.scheduleDirtChange.call(this,e,i),this.collectSoundsCount&&(this.collectSoundsI=this.collectSoundsI||0,this.playAudio_("collect"+this.collectSoundsI),this.collectSoundsI+=1,this.collectSoundsI%=this.collectSoundsCount),this.emit("collected",this.getTotalCollected())},e.prototype.isCollector=function(){return!0},e.prototype.tryCollect=function(t,e){var i=this.maze_.map.getValue(t,e);return void 0===i||i<1?(this.emit("collectedTooMany"),!1):(this.maze_.map.setValue(t,e,i-1),!0)},e.prototype.getTotalCollected=function(){var t=0;return this.maze_.map.forEachCell(function(e,i,r){e.isDirt()&&(t+=e.getOriginalValue()-e.getCurrentValue())}),t},e.prototype.loadAudio=function(t){var e=this;t.collectSounds&&(this.collectSoundsCount=t.collectSounds.length,t.collectSounds.forEach(function(t,i){e.maze_.loadAudio(t,"collect"+i)}))},e.prototype.createDrawer=function(t){this.drawer=new n(this.maze_.map,this.skin_.goal,t)},e.prototype.getEmptyTile=function(){return"null0"},e.prototype.drawTile=function(e,i,r,n,o){t.prototype.drawTile.call(this,e,i,r,n,o),this.drawCorners(e,r,n,o)},e.prototype.drawCorners=function(t,e,i,r){var n=this,o={NE:[1,-1],NW:[-1,-1],SE:[1,1],SW:[-1,1]},s="http://www.w3.org/2000/svg",a=t.getElementsByClassName("pegman-location")[0];this.isWallOrOutOfBounds_(i,e)||Object.keys(o).filter(function(t){var r=o[t];return!n.isWallOrOutOfBounds_(i+r[0],e)&&!n.isWallOrOutOfBounds_(i,e+r[1])&&n.isWallOrOutOfBounds_(i+r[0],e+r[1])}).forEach(function(u){var l=document.createElementNS(s,"clipPath");l.setAttribute("id","tileCorner"+u+"ClipPath"+r);var p=document.createElementNS(s,"rect");p.setAttribute("width",25),p.setAttribute("height",25);var c=o[u];p.setAttribute("x",50*i+50*(c[0]+1)/4),p.setAttribute("y",50*e+50*(c[1]+1)/4),l.appendChild(p),t.appendChild(l);var h=document.createElementNS(s,"image");h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n.skin_.corners),h.setAttribute("height",50),h.setAttribute("width",50),h.setAttribute("x",50*i),h.setAttribute("y",50*e),h.setAttribute("id","tileCorner"+u+r),h.setAttribute("clip-path","url(#"+l.id+")"),t.insertBefore(h,a)})},e}(r)},function(t,e,i){"use strict";var r=i(3),n=r.SQUARE_SIZE,o=r.SVG_NS;t.exports=function(t){function e(i,r,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,"",n));return s.skin_=r,s.bee_=o,s.clouded_=void 0,s.resetClouded(),s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.getAsset=function(t,e,i){switch(t){case"cloud":return this.skin_.cloud;case"cloudAnimation":return this.skin_.cloudAnimation;case"beeItem":if(this.bee_.isHive(e,i,!1))return this.skin_.honey;if(this.bee_.isFlower(e,i,!1))return this.flowerImageHref_(e,i)}},e.prototype.reset=function(){this.resetClouded()},e.prototype.resetClouded=function(){this.clouded_=this.map_.currentStaticGrid.map(function(t){return[]})},e.prototype.updateItemImage=function(t,e,i){var r,n=this.bee_.isCloudable(t,e),o=!i&&n,s=n&&!0===this.clouded_[t][e],a=Math.abs(this.bee_.getValue(t,e));r=o||isNaN(a)?"":!i&&this.bee_.isPurpleFlower(t,e)?"?":99===a?"":98===a?"0":""+a;var u=this.drawImage_("beeItem",t,e);this.updateOrCreateText_("counter",t,e,u?r:""),o?(this.showCloud_(t,e),this.clouded_[t][e]=!0):s&&(this.hideCloud_(t,e),this.clouded_[t][e]=!1)},e.prototype.flowerImageHref_=function(t,e){return this.bee_.isRedFlower(t,e)?this.skin_.redFlower:this.skin_.purpleFlower},e.prototype.showCloud_=function(t,e){this.drawImage_("cloud",t,e),this.displayCloudAnimation_(t,e,!1)},e.prototype.hideCloud_=function(t,e){var i=document.getElementById(r.cellId("cloud",t,e));i&&i.setAttribute("visibility","hidden"),this.displayCloudAnimation_(t,e,!0)},e.prototype.displayCloudAnimation_=function(t,e,i){this.getOrCreateImage_("cloudAnimation",t,e,!1).setAttribute("visibility",i?"visible":"hidden")},e.prototype.addCheckerboardTile=function(t,e,i){var r=document.createElementNS(o,"rect");if(r.setAttribute("width",n),r.setAttribute("height",n),r.setAttribute("x",e*n),r.setAttribute("y",t*n),r.setAttribute("fill","#78bb29"),r.setAttribute("opacity",i?.2:.5),i)this.svg_.appendChild(r);else{var s=this.svg_.querySelector("#tileElement"+(8*t+e));this.svg_.insertBefore(r,s)}},e}(r)},function(t,e,i){"use strict";var r=i(4),n=i(0).SquareType,o={NONE:void 0,HIVE:0,FLOWER:1,VARIABLE:2},s={NONE:void 0,STATIC:0,HIVE_OR_FLOWER:1,FLOWER_OR_NOTHING:2,HIVE_OR_NOTHING:3,ANY:4},a={DEFAULT:void 0,RED:0,PURPLE:1};t.exports=function(t){function e(i,r,n,o,s,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),r===e.FeatureType.NONE&&(n=void 0,a=void 0);var u=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,n,a));return u.featureType_=r,u.flowerColor_=s,u.cloudType_=o,u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.isFlower=function(){return this.featureType_===o.FLOWER},e.prototype.isHive=function(){return this.featureType_===o.HIVE},e.prototype.isRedFlower=function(){return this.isFlower()&&this.flowerColor_===a.RED},e.prototype.isPurpleFlower=function(){return this.isFlower()&&this.flowerColor_===a.PURPLE},e.prototype.isStaticCloud=function(){return this.cloudType_===s.STATIC},e.prototype.isVariableCloud=function(){return this.cloudType_!==s.NONE&&this.cloudType_!==s.STATIC},e.prototype.isVariable=function(){return this.isVariableRange()||this.isVariableCloud()},e.prototype.getPossibleGridAssets=function(){var t=[];if(this.isVariableCloud()){var i=new e(this.tileType_,o.FLOWER,this.originalValue_,s.STATIC,this.flowerColor_),r=new e(this.tileType_,o.HIVE,this.originalValue_,s.STATIC),n=new e(this.tileType_,o.NONE,void 0,s.STATIC);switch(this.cloudType_){case s.HIVE_OR_FLOWER:t=[i,r];break;case s.FLOWER_OR_NOTHING:t=[i,n];break;case s.HIVE_OR_NOTHING:t=[r,n];break;case s.ANY:t=[i,r,n]}}else if(this.isVariableRange())for(var u=this.originalValue_;u<=this.range_;u++)t.push(new e(this.tileType_,o.FLOWER,u,s.NONE,a.PURPLE));else t.push(this);return t},e.prototype.serialize=function(){return Object.assign({},t.prototype.serialize.call(this),{featureType:this.featureType_,cloudType:this.cloudType_,flowerColor:this.flowerColor_})},e.deserialize=function(t){return new e(t.tileType,t.featureType,t.value,t.cloudType,t.flowerColor,t.range)},e.parseFromOldValues=function(t,i){t=t.toString(),i=parseInt(i);var r=void 0,u=void 0,l=void 0,p=void 0,c=void 0;return!isNaN(i)&&t.match(/[1|R|P|FC]/)&&0!==i?(r=n.OPEN,u=i>0?o.FLOWER:o.HIVE,l=Math.abs(i),p="FC"===t?s.STATIC:s.NONE,c="R"===t?a.RED:"P"===t?a.PURPLE:a.DEFAULT):r=parseInt(t),new e(r,u,l,p,c)},e}(r),t.exports.FeatureType=o,t.exports.CloudType=s,t.exports.FlowerColor=a},function(t,e,i){"use strict";var r=i(2).randomValue,n=i(6),o=i(25),s=i(24);t.exports=function(t){function e(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,r)),o=r.level;return n.defaultFlowerColor_=o&&"redWithNectar"===o.flowerType?"red":"purple",n.userChecks_=[],n.overrideStepSpeed=2,n.honey_=void 0,n.nectars_=void 0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.isBee=function(){return!0},e.prototype.getCellClass=function(){return o},e.prototype.loadAudio=function(t){t.beeSound&&(this.maze_.loadAudio(t.nectarSound,"nectar"),this.maze_.loadAudio(t.honeySound,"honey"))},e.prototype.createDrawer=function(t){this.drawer=new s(this.maze_.map,this.skin_,t,this)},e.prototype.reset=function(){this.honey_=0,this.nectars_=[];for(var e=0;e<this.maze_.map.currentStaticGrid.length;e++){this.userChecks_[e]=[];for(var i=0;i<this.maze_.map.currentStaticGrid[e].length;i++)this.userChecks_[e][i]={checkedForFlower:!1,checkedForHive:!1,checkedForNectar:!1}}t.prototype.reset.call(this)},e.prototype.getHoneyCount=function(){return this.honey_},e.prototype.getNectarCount=function(){return this.nectars_.length},e.prototype.isHive=function(t,e){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(this.userChecks_[t][e].checkedForHive=!0),this.maze_.map.currentStaticGrid[t][e].isHive()},e.prototype.isFlower=function(t,e){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(this.userChecks_[t][e].checkedForFlower=!0),this.maze_.map.currentStaticGrid[t][e].isFlower()},e.prototype.isCloudable=function(t,e){return this.maze_.map.currentStaticGrid[t][e].isStaticCloud()},e.prototype.shouldCheckCloud=function(t,e){return this.maze_.map.getVariableCell(t,e).isStaticCloud()},e.prototype.shouldCheckPurple=function(t,e){return this.isPurpleFlower(t,e)&&!this.maze_.map.getVariableCell(t,e).isVariableRange()},e.prototype.checkedCloud=function(t,e){return this.userChecks_[t][e].checkedForFlower||this.userChecks_[t][e].checkedForHive},e.prototype.checkedAllClouded=function(){for(var t=0;t<this.maze_.map.currentStaticGrid.length;t++)for(var e=0;e<this.maze_.map.currentStaticGrid[t].length;e++)if(this.shouldCheckCloud(t,e)&&!this.checkedCloud(t,e))return!1;return!0},e.prototype.checkedAllPurple=function(){for(var t=0;t<this.maze_.map.currentStaticGrid.length;t++)for(var e=0;e<this.maze_.map.currentStaticGrid[t].length;e++)if(this.shouldCheckPurple(t,e)&&!this.userChecks_[t][e].checkedForNectar)return!1;return!0},e.prototype.isRedFlower=function(t,e){return!!this.isFlower(t,e,!1)&&(!!this.maze_.map.currentStaticGrid[t][e].isRedFlower()||!this.maze_.map.currentStaticGrid[t][e].isPurpleFlower()&&"red"===this.defaultFlowerColor_)},e.prototype.isPurpleFlower=function(t,e){return this.isFlower(t,e,!1)&&!this.isRedFlower(t,e)},e.prototype.hiveRemainingCapacity=function(t,e){if(!this.isHive(t,e))return 0;var i=this.getValue(t,e);return-99===i?1/0:-98===i?0:i},e.prototype.flowerRemainingCapacity=function(t,e){if(!this.isFlower(t,e))return 0;var i=this.getValue(t,e);return 99===i?1/0:98===i?0:i},e.prototype.madeHoneyAt=function(t,e){-99!==this.getValue(t,e)&&this.setValue(t,e,this.getValue(t,e)-1),this.honey_+=1},e.prototype.gotNectarAt=function(t,e){99!==this.getValue(t,e)&&this.setValue(t,e,this.getValue(t,e)-1),this.nectars_.push({row:t,col:e})},e.prototype.tryGetNectar=function(){var t=this.maze_.pegmanX,e=this.maze_.pegmanY;return this.isFlower(e,t)?0===this.flowerRemainingCapacity(e,t)?(this.emit("flowerEmpty"),!1):(this.gotNectarAt(e,t),!0):(this.emit("notAtFlower"),!1)},e.prototype.tryMakeHoney=function(){var t=this.maze_.pegmanX,e=this.maze_.pegmanY;return this.isHive(e,t)?0===this.hiveRemainingCapacity(e,t)?(this.emit("hiveFull"),!1):(this.madeHoneyAt(e,t),!0):(this.emit("notAtHive"),!1)},e.prototype.nectarRemaining=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.maze_.pegmanX,i=this.maze_.pegmanY;return t&&(this.userChecks_[i][e].checkedForNectar=!0),this.flowerRemainingCapacity(i,e)},e.prototype.honeyAvailable=function(){var t=this.maze_.pegmanX,e=this.maze_.pegmanY;return this.hiveRemainingCapacity(e,t)},e.prototype.animateGetNectar=function(){var t=this.maze_.pegmanX,e=this.maze_.pegmanY;if(this.getValue(e,t)<=0)throw new Error("Shouldn't be able to end up with a nectar animation if there was no nectar to be had");this.playAudio_("nectar"),this.gotNectarAt(e,t),this.drawer.updateItemImage(e,t,!0)},e.prototype.animateMakeHoney=function(){var t=this.maze_.pegmanX,e=this.maze_.pegmanY;if(!this.isHive(e,t))throw new Error("Shouldn't be able to end up with a honey animation if we arent at a hive or dont have nectar");this.playAudio_("honey"),this.madeHoneyAt(e,t),this.drawer.updateItemImage(e,t,!0)},e.prototype.getEmptyTile=function(t,e,i){for(var n=["null3","null4","null0"],o=i?2*n.length:6*n.length,s=0;s<o;s++)n.push("null1");return r(n)},e.prototype.drawTile=function(e,i,r,n,o){if(t.prototype.drawTile.call(this,e,i,r,n,o),(r+n)%2==0){var s=!this.isWallOrOutOfBounds_(n,r);this.drawer.addCheckerboardTile(r,n,s)}},e}(n)},function(t,e,i){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(t){return"function"==typeof t}function s(t){return"object"===(void 0===t?"undefined":r(t))&&null!==t}function a(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!function(t){return"number"==typeof t}(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,i,r,n,u,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var p=new Error('Uncaught, unspecified "error" event. ('+e+")");throw p.context=e,p}if(a(i=this._events[t]))return!1;if(o(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1),i.apply(this,n)}else if(s(i))for(n=Array.prototype.slice.call(arguments,1),r=(l=i.slice()).length,u=0;u<r;u++)l[u].apply(this,n);return!0},n.prototype.addListener=function(t,e){var i;if(!o(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,o(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(i=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){if(!o(e))throw TypeError("listener must be a function");var i=!1;function r(){this.removeListener(t,r),i||(i=!0,e.apply(this,arguments))}return r.listener=e,this.on(t,r),this},n.prototype.removeListener=function(t,e){var i,r,n,a;if(!o(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=(i=this._events[t]).length,r=-1,i===e||o(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(i)){for(a=n;a-- >0;)if(i[a]===e||i[a].listener&&i[a].listener===e){r=a;break}if(r<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(o(i=this._events[t]))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){return this._events&&this._events[t]?o(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(o(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,i){"use strict";var r=i(3),n=r.SQUARE_SIZE,o=22*n;t.exports=function(t){function e(i,r,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,r,n))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.getAsset=function(e,i,r){return 0===(this.map_.getValue(i,r)||0)?void 0:t.prototype.getAsset.call(this,e,i,r)},e.prototype.updateItemImage=function(i,r,o){var s=t.prototype.updateItemImage.call(this,i,r,o);if(s){var a=this.map_.getValue(i,r)||0;this.map_.getVariableCell(i,r).isVariable()&&(o?this.updateOrCreateText_("counter",i,r,""):(a=a<0?-11:11,this.updateOrCreateText_("counter",i,r,"?")));var u=e.spriteIndexForDirt(a),l=u<0;return s.setAttribute("visibility",l?"hidden":"visible"),l||s.setAttribute("x",n*(r-u)),s}},e.prototype.getOrCreateImage_=function(e,i,r){var n=t.prototype.getOrCreateImage_.call(this,e,i,r);return n&&n.setAttribute("width",o),n},e.spriteIndexForDirt=function(t){var e=void 0;return 0===t?e=-1:t<-10?e=0:t<0?e=10+t+1:t>10?e=21:t>0&&(e=10+t),e},e}(r)},function(t,e,i){"use strict";var r=i(1);t.exports=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.isFarmer=function(){return!0},e}(r)},function(t,e,i){"use strict";var r=i(5).SVG_NS,n=i(7),o=n.displayPegman,s=n.getPegmanYForRow,a=i(8),u=i(2),l=i(0);t.exports=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.maze=e,this.svg=i,this.createAnimations_()}return t.prototype.createAnimations_=function(){var t=this;if(this.maze.skin.idlePegmanAnimation&&(this.createPegmanAnimation_({idStr:"idle",pegmanImage:this.maze.skin.idlePegmanAnimation,row:this.maze.subtype.start.y,col:this.maze.subtype.start.x,direction:this.maze.startDirection,numColPegman:this.maze.skin.idlePegmanCol,numRowPegman:this.maze.skin.idlePegmanRow}),this.maze.skin.idlePegmanCol>1||this.maze.skin.idlePegmanRow>1)){var e=this.maze.skin.idlePegmanRow,i=document.getElementById("idlePegman"),n=0;setInterval(function(){"visible"===i.getAttribute("visibility")&&(t.updatePegmanAnimation_({idStr:"idle",row:t.maze.subtype.start.y,col:t.maze.subtype.start.x,direction:t.maze.startDirection,animationRow:n}),n=(n+1)%e)},600)}if(this.maze.skin.celebrateAnimation&&this.createPegmanAnimation_({idStr:"celebrate",pegmanImage:this.maze.skin.celebrateAnimation,row:this.maze.subtype.start.y,col:this.maze.subtype.start.x,direction:l.Direction.NORTH,numColPegman:this.maze.skin.celebratePegmanCol,numRowPegman:this.maze.skin.celebratePegmanRow}),this.maze.skin.wallPegmanAnimation&&this.createPegmanAnimation_({idStr:"wall",pegmanImage:this.maze.skin.wallPegmanAnimation}),this.maze.skin.hittingWallAnimation&&this.maze.skin.hittingWallAnimationFrameNumber&&(this.createPegmanAnimation_({idStr:"wall",pegmanImage:this.maze.skin.hittingWallAnimation,numColPegman:this.maze.skin.hittingWallPegmanCol,numRowPegman:this.maze.skin.hittingWallPegmanRow}),document.getElementById("wallPegman").setAttribute("visibility","hidden")),this.maze.skin.movePegmanAnimation&&this.createPegmanAnimation_({idStr:"move",pegmanImage:this.maze.skin.movePegmanAnimation,numColPegman:4,numRowPegman:this.maze.skin.movePegmanAnimationFrameNumber||9}),this.maze.skin.hittingWallAnimation){var o=document.createElementNS(r,"image");o.setAttribute("id","wallAnimation"),o.setAttribute("height",this.maze.SQUARE_SIZE),o.setAttribute("width",this.maze.SQUARE_SIZE),o.setAttribute("visibility","hidden"),this.svg.appendChild(o)}},t.prototype.reset=function(t){var e=this;if(t){this.maze.skin.danceOnLoad&&this.scheduleDance(!1,750),a.setTimeout(function(){e.maze.stepSpeed=100,e.scheduleTurn(e.maze.startDirection)},900)}else{this.displayPegman(this.maze.pegmanX,this.maze.pegmanY,l.directionToFrame(this.maze.pegmanD));var i=document.getElementById("finish");i&&(i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.maze.skin.goalIdle),i.setAttribute("visibility","visible"))}var r=document.getElementById("look");r.style.display="none",r.parentNode.appendChild(r);for(var n=r.getElementsByTagName("path"),o=0;o<n.length;o++){n[o].setAttribute("stroke",this.maze.skin.look)}var s=document.getElementById("pegman");(s.setAttribute("opacity",1),this.maze.skin.idlePegmanAnimation)?(s.setAttribute("visibility","hidden"),document.getElementById("idlePegman").setAttribute("visibility","visible")):s.setAttribute("visibility","visible");this.maze.skin.wallPegmanAnimation&&document.getElementById("wallPegman").setAttribute("visibility","hidden");this.maze.skin.movePegmanAnimation&&document.getElementById("movePegman").setAttribute("visibility","hidden");this.maze.skin.celebrateAnimation&&document.getElementById("celebratePegman").setAttribute("visibility","hidden")},t.prototype.createPegmanAnimation_=function(t){var e=document.createElementNS(r,"clipPath");e.setAttribute("id",t.idStr+"PegmanClip");var i=document.createElementNS(r,"rect");i.setAttribute("id",t.idStr+"PegmanClipRect"),void 0!==t.col&&i.setAttribute("x",t.col*this.maze.SQUARE_SIZE+1+this.maze.PEGMAN_X_OFFSET),void 0!==t.row&&i.setAttribute("y",s(this.maze.skin,t.row)),i.setAttribute("width",this.maze.PEGMAN_WIDTH),i.setAttribute("height",this.maze.PEGMAN_HEIGHT),e.appendChild(i),this.svg.appendChild(e);var n=t.pegmanImage,o=document.createElementNS(r,"image");if(o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),o.setAttribute("height",this.maze.PEGMAN_HEIGHT*(t.numRowPegman||1)),o.setAttribute("width",this.maze.PEGMAN_WIDTH*(t.numColPegman||4)),o.setAttribute("clip-path","url(#"+t.idStr+"PegmanClip)"),o.setAttribute("id",t.idStr+"Pegman"),this.svg.appendChild(o),void 0!==t.col&&void 0!==t.direction){var a=this.maze.SQUARE_SIZE*t.col-t.direction*this.maze.PEGMAN_WIDTH+1+this.maze.PEGMAN_X_OFFSET;o.setAttribute("x",a)}void 0!==t.row&&o.setAttribute("y",s(this.maze.skin,t.row))},t.prototype.getPegmanFrameOffsetY_=function(t){return(t=t||0)*this.maze.PEGMAN_HEIGHT},t.prototype.updatePegmanAnimation_=function(t){var e=document.getElementById(t.idStr+"PegmanClipRect");e.setAttribute("x",t.col*this.maze.SQUARE_SIZE+1+this.maze.PEGMAN_X_OFFSET),e.setAttribute("y",s(this.maze.skin,t.row));var i=document.getElementById(t.idStr+"Pegman"),r=this.maze.SQUARE_SIZE*t.col-t.direction*this.maze.PEGMAN_WIDTH+1+this.maze.PEGMAN_X_OFFSET;i.setAttribute("x",r);var n=s(this.maze.skin,t.row)-this.getPegmanFrameOffsetY_(t.animationRow);i.setAttribute("y",n),i.setAttribute("visibility","visible")},t.prototype.scheduleSheetedMovement_=function(t,e,i,r,n,o,s){var l=this,p=document.getElementById("pegman");u.range(0,i-1).forEach(function(u){a.setTimeout(function(){s&&p.setAttribute("visibility","hidden"),l.updatePegmanAnimation_({idStr:n,col:t.x+e.x*u/i,row:t.y+e.y*u/i,direction:o,animationRow:u})},r*u)})},t.prototype.scheduleMove=function(t,e,i){var r,n,o=this,s=this.maze.pegmanX,p=this.maze.pegmanY,c=this.maze.pegmanD,h=t-s,f=e-p;if(this.maze.skin.movePegmanAnimation){r=this.maze.skin.movePegmanAnimationFrameNumber;var m=document.getElementById("pegman"),d=document.getElementById("movePegman");n=i/r,this.scheduleSheetedMovement_({x:s,y:p},{x:h,y:f},r,n,"move",c,!0),a.setTimeout(function(){d.setAttribute("visibility","hidden"),m.setAttribute("visibility","visible"),o.displayPegman(t,e,l.directionToFrame(c)),o.maze.subtype.isWordSearch()&&o.maze.subtype.markTileVisited(e,t,!0)},n*r)}else n=i/(r=4),u.range(1,r).forEach(function(t){a.setTimeout(function(){o.displayPegman(s+h*t/r,p+f*t/r,l.directionToFrame(c))},n*t)});if(this.maze.skin.approachingGoalAnimation){var y=document.getElementById("finish");this.maze.subtype.finish&&Math.abs(t-this.maze.subtype.finish.x)<=1&&Math.abs(e-this.maze.subtype.finish.y)<=1?y.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.maze.skin.approachingGoalAnimation):y.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.maze.skin.goalIdle)}},t.prototype.scheduleTurn=function(t){var e=this,i=this.maze.pegmanD,r=t-i;u.range(1,4).forEach(function(t){a.setTimeout(function(){e.displayPegman(e.maze.pegmanX,e.maze.pegmanY,l.directionToFrame(i+r*t/4))},e.maze.stepSpeed*(t-1))})},t.prototype.crackSurroundingIce=function(t,e){var i=this;this.updateSurroundingTiles_(e,t,function(t,e){e.getTile()===l.SquareType.OPEN?t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i.maze.skin.largerObstacleAnimationTiles):e.getTile()===l.SquareType.OBSTACLE&&t.setAttribute("opacity",0)})},t.prototype.updateSurroundingTiles_=function(t,e,i){for(var r=[[t-1,e-1],[t-1,e],[t-1,e+1],[t,e-1],[t,e],[t,e+1],[t+1,e-1],[t+1,e],[t+1,e+1]],n=0;n<r.length;++n){var o=r[n][1],s=r[n][0],a=o+this.maze.map.COLS*s,u=document.getElementById("tileElement"+a);u&&i(u,this.maze.map.getCell(s,o))}},t.prototype.scheduleWallHit=function(t,e,i,r,n){var o=this;if(this.maze.skin.hittingWallAnimation){var s=document.getElementById("wallAnimation"),u=this.maze.skin.hittingWallAnimationFrameNumber||0;if(u>1){r>=0&&(r+=1);this.scheduleSheetedMovement_({x:this.maze.pegmanX,y:this.maze.pegmanY},{x:i,y:r},u,100,"wall",l.Direction.NORTH,!0),setTimeout(function(){document.getElementById("wallPegman").setAttribute("visibility","hidden")},100*u)}else a.setTimeout(function(){s.setAttribute("x",o.maze.SQUARE_SIZE*(o.maze.pegmanX+.5+.5*i)-s.getAttribute("width")/2),s.setAttribute("y",o.maze.SQUARE_SIZE*(o.maze.pegmanY+1+.5*r)-s.getAttribute("height")),s.setAttribute("visibility","visible"),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o.maze.skin.hittingWallAnimation)},this.maze.stepSpeed/2)}a.setTimeout(function(){o.displayPegman(o.maze.pegmanX,o.maze.pegmanY,n)},this.maze.stepSpeed),a.setTimeout(function(){o.displayPegman(o.maze.pegmanX+i/4,o.maze.pegmanY+r/4,n)},2*this.maze.stepSpeed),a.setTimeout(function(){o.displayPegman(o.maze.pegmanX,o.maze.pegmanY,n)},3*this.maze.stepSpeed),this.maze.skin.wallPegmanAnimation&&a.setTimeout(function(){document.getElementById("pegman").setAttribute("visibility","hidden"),o.updatePegmanAnimation_({idStr:"wall",row:o.maze.pegmanY,col:o.maze.pegmanX,direction:o.maze.pegmanD})},4*this.maze.stepSpeed)},t.prototype.scheduleObstacleHit=function(t,e,i,r,n){var o=this,s=t+this.maze.map.COLS*e;if(document.getElementById("obstacle"+s).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.maze.skin.obstacleAnimation),a.setTimeout(function(){o.displayPegman(o.maze.pegmanX+i/2,o.maze.pegmanY+r/2,n)},this.maze.stepSpeed),this.maze.skin.largerObstacleAnimationTiles&&a.setTimeout(function(){o.updateSurroundingTiles_(e,t,function(t){return t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o.maze.skin.largerObstacleAnimationTiles)})},this.maze.stepSpeed),!this.maze.skin.nonDisappearingPegmanHittingObstacle){var u=document.getElementById("pegman");a.setTimeout(function(){u.setAttribute("visibility","hidden")},2*this.maze.stepSpeed)}},t.prototype.scheduleLook=function(t,e,i){var r=document.getElementById("look");r.setAttribute("transform","translate("+t+", "+e+") rotate("+i+" 0 0) scale(.4)");var n=r.getElementsByTagName("path");r.style.display="inline";for(var o=0;o<n.length;o++){var s=n[o];this.scheduleLookStep_(s,this.maze.stepSpeed*o)}},t.prototype.scheduleLookStep_=function(t,e){var i=this;a.setTimeout(function(){t.style.display="inline",window.setTimeout(function(){t.style.display="none"},2*i.maze.stepSpeed)},e)},t.prototype.stopIdling=function(){if(this.maze.skin.idlePegmanAnimation){var t=document.getElementById("pegman");document.getElementById("idlePegman").setAttribute("visibility","hidden"),t.setAttribute("visibility","visible")}},t.prototype.scheduleDance=function(t,e){var i=this,r=document.getElementById("finish");if(t&&this.maze.skin.celebrateAnimation){r&&r.setAttribute("visibility","hidden");var n=this.maze.skin.celebratePegmanRow,o=e/n,s={x:this.maze.pegmanX,y:this.maze.pegmanY};this.scheduleSheetedMovement_({x:s.x,y:s.y},{x:0,y:0},n,o,"celebrate",l.Direction.NORTH,!0)}else{var u=l.directionToFrame(this.maze.pegmanD);this.displayPegman(this.maze.pegmanX,this.maze.pegmanY,16),t&&r&&r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.maze.skin.goalAnimation);var p=e/5;a.setTimeout(function(){i.displayPegman(i.maze.pegmanX,i.maze.pegmanY,18)},p),a.setTimeout(function(){i.displayPegman(i.maze.pegmanX,i.maze.pegmanY,20)},2*p),a.setTimeout(function(){i.displayPegman(i.maze.pegmanX,i.maze.pegmanY,18)},3*p),a.setTimeout(function(){i.displayPegman(i.maze.pegmanX,i.maze.pegmanY,20)},4*p),a.setTimeout(function(){t&&!i.maze.skin.turnAfterVictory||i.displayPegman(i.maze.pegmanX,i.maze.pegmanY,u),t&&i.maze.skin.transparentTileEnding&&i.setTileTransparent_(),i.maze.subtype.isWordSearch()&&i.setPegmanTransparent_()},5*p)}},t.prototype.setTileTransparent_=function(){for(var t=0,e=0;e<this.maze.map.ROWS;e++)for(var i=0;i<this.maze.map.COLS;i++){var r=document.getElementById("tileElement"+t),n=document.getElementById("tileAnimation"+t);r&&r.setAttribute("opacity",0),n&&n.beginElement&&n.beginElement(),t++}},t.prototype.setPegmanTransparent_=function(){var t=document.getElementById("pegmanFadeoutAnimation"),e=document.getElementById("pegman");e&&e.setAttribute("opacity",0),t&&t.beginElement&&t.beginElement()},t.prototype.displayPegman=function(t,e,i){var r=document.getElementById("pegman"),n=document.getElementById("clipRect");o(this.maze.skin,r,n,t,e,i)},t}()},function(t,e,i){"use strict";var r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],r=!0,n=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);r=!0);}catch(t){n=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var n=i(8),o=i(30),s=i(12),a=i(7),u=i(2).getSubtypeForSkin,l=i(0);t.exports=function(){function t(e,i,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.stepSpeed=100,this.level=e,this.skin=i,this.startDirection=null,this.subtype=null,this.map=null,this.animationsController=null,this.pegmanD=null,this.pegmanX=null,this.pegmanY=null,this.MAZE_HEIGHT=null,this.MAZE_WIDTH=null,this.PATH_WIDTH=null,this.PEGMAN_HEIGHT=null,this.PEGMAN_WIDTH=null,this.PEGMAN_X_OFFSET=null,this.PEGMAN_Y_OFFSET=null,this.SQUARE_SIZE=null,n.methods&&this.rebindMethods(n.methods);var o=u(r.skinId);this.subtype=new o(this,r),this.loadLevel_()}return t.prototype.playAudio=function(){},t.prototype.playAudioOnFailure=function(){},t.prototype.loadAudio=function(){},t.prototype.getTestResults=function(){},t.prototype.rebindMethods=function(t){this.playAudio=t.playAudio||this.playAudio,this.playAudioOnFailure=t.playAudioOnFailure||this.playAudioOnFailure,this.loadAudio=t.loadAudio||this.loadAudio,this.getTestResults=t.getTestResults||this.getTestResults},t.prototype.initWithSvg=function(t){t.setAttribute("width",this.MAZE_WIDTH),t.setAttribute("height",this.MAZE_HEIGHT),a(t,this.skin,this.subtype,this.map,this.SQUARE_SIZE),this.animationsController=new o(this,t)},t.prototype.loadLevel_=function(){this.level.serializedMaze?this.map=s.deserialize(this.level.serializedMaze,this.subtype.getCellClass()):this.map=s.parseFromOldValues(this.level.map,this.level.initialDirt,this.subtype.getCellClass()),this.startDirection=this.level.startDirection,this.level.fastGetNectarAnimation&&(this.skin.actionSpeedScale.nectar=.5),this.SQUARE_SIZE=50,this.PEGMAN_HEIGHT=this.skin.pegmanHeight,this.PEGMAN_WIDTH=this.skin.pegmanWidth,this.PEGMAN_X_OFFSET=this.skin.pegmanXOffset||0,this.PEGMAN_Y_OFFSET=this.skin.pegmanYOffset,this.MAZE_WIDTH=this.SQUARE_SIZE*this.map.COLS,this.MAZE_HEIGHT=this.SQUARE_SIZE*this.map.ROWS,this.PATH_WIDTH=this.SQUARE_SIZE/3},t.prototype.resetDirtImages=function(t){var e=this;this.map.forEachCell(function(i,r,n){e.subtype.drawer.updateItemImage(r,n,t)})},t.prototype.gridNumberToPosition_=function(t){return(t+.5)*this.SQUARE_SIZE},t.prototype.drawHintPath=function(t,e){var i=this;t.getElementById("hintPath").setAttribute("d","M"+e.map(function(t){var e=r(t,2),n=e[0],o=e[1];return i.gridNumberToPosition_(n)+","+i.gridNumberToPosition_(o)}).join(" "))},t.prototype.reset=function(t){this.subtype.reset(),n.clearTimeouts(),this.pegmanX=this.subtype.start.x,this.pegmanY=this.subtype.start.y,this.pegmanD=this.startDirection,this.animationsController.reset(t),this.map.resetDirt(),this.resetDirtImages(!1);var e,i,r=0;for(i=0;i<this.map.ROWS;i++)for(e=0;e<this.map.COLS;e++){var o=document.getElementById("obstacle"+r);o&&o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.skin.obstacleIdle),++r}this.subtype.resetTiles?this.subtype.resetTiles():this.resetTiles_()},t.prototype.resetTiles_=function(){for(var t=0,e=0;e<this.map.ROWS;e++)for(var i=0;i<this.map.COLS;i++){document.getElementById("tileClipPath"+t).setAttribute("visibility","visible");var r=document.getElementById("tileElement"+t);r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.skin.tiles),r.setAttribute("opacity",1),t++}},t.prototype.animatedFinish=function(t){this.animationsController.scheduleDance(!0,t)},t.prototype.animatedMove=function(t,e){var i=l.directionToDxDy(t),r=this.pegmanX+i.dx,n=this.pegmanY+i.dy;this.animationsController.scheduleMove(r,n,e),this.playAudio("walk"),this.pegmanX=r,this.pegmanY=n},t.prototype.animatedTurn=function(t){var e=this.pegmanD+t;this.animationsController.scheduleTurn(e),this.pegmanD=l.constrainDirection4(e)},t.prototype.animatedFail=function(t){var e=this,i=l.directionToDxDy(this.pegmanD),r=i.dx,o=i.dy;t||(r=-r,o=-o);var s=this.pegmanX+r,a=this.pegmanY+o,u=l.directionToFrame(this.pegmanD);this.animationsController.displayPegman(this.pegmanX+r/4,this.pegmanY+o/4,u);var p=this.map.getTile(a,s);p===l.SquareType.WALL||void 0===p||this.subtype.isScrat()&&p===l.SquareType.OBSTACLE?(this.playAudio("wall"),void 0!==p&&this.playAudio("wall"+this.subtype.wallMap[a][s]),this.subtype.isScrat()&&p===l.SquareType.OBSTACLE&&this.animationsController.crackSurroundingIce(s,a),this.animationsController.scheduleWallHit(s,a,r,o,u),n.setTimeout(function(){e.playAudioOnFailure()},2*this.stepSpeed)):p===l.SquareType.OBSTACLE&&(this.playAudio("obstacle"),this.animationsController.scheduleObstacleHit(s,a,r,o,u),n.setTimeout(function(){e.playAudioOnFailure()},this.stepSpeed))},t.prototype.animatedLook=function(t){var e=this.pegmanX,i=this.pegmanY;switch(t){case l.Direction.NORTH:e+=.5;break;case l.Direction.EAST:e+=1,i+=.5;break;case l.Direction.SOUTH:e+=.5,i+=1;break;case l.Direction.WEST:i+=.5}e*=this.SQUARE_SIZE,i*=this.SQUARE_SIZE;var r=90*t-45;this.animationsController.scheduleLook(e,i,r)},t.prototype.scheduleDirtChange_=function(t){var e=this.pegmanX,i=this.pegmanY,r=this.map.getValue(i,e)||0;this.map.setValue(i,e,r+t.amount),this.subtype.scheduleDirtChange(i,e),this.playAudio(t.sound)},t.prototype.scheduleFill=function(){this.scheduleDirtChange_({amount:1,sound:"fill"})},t.prototype.scheduleDig=function(){this.scheduleDirtChange_({amount:-1,sound:"dig"})},t}()},function(t,e,i){"use strict";var r=i(31),n=i(11),o=i(5).SVG_NS,s=document.createElement("div");document.body.appendChild(s);var a=document.createElementNS(o,"svg");s.appendChild(a);var u=document.createElementNS(o,"g");u.id="look",a.appendChild(u);var l=window.mazeController=new r(n.level,n.skin,n);l.map.resetDirt(),l.subtype.initStartFinish(),l.subtype.createDrawer(a),l.subtype.initWallMap(),s.style.width=l.MAZE_WIDTH+"px",l.initWithSvg(a),l.reset(!0)}]);